<!---<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas><-->
<style type="text/css">
.selectedImage {
	border: yellow thick solid;
}
</style>

<div id="main"></div>

<script src="/socket.io/socket.io.js"></script>
<!---<script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.min.js"></script><-->

<script>
	//const ctx = document.getElementById("ctx").getContext("2d")
	//const canvas = document.querySelector('canvas')
	const html = document.getElementById("main")
	const socket = io()

	let myHand = []
	let myPlayerList = []
	let myPlayerID
	let myGameMasterID
	let selectedImgID = null

	const onImgClick = (id) => {
		if (id === selectedImgID)
			selectedImgID = null
		else
			selectedImgID = id
		socket.emit('SelectedCardChanged', {
			cardIndex: id
		})
		draw()
	}

	const drawHand = () => {
		for (let i = 0; i < myHand.length; ++i){
			html.innerHTML += '<img src = ' + myHand[i] 
						    + ' width = 200'
						    + (selectedImgID == i ? ' class = selectedImage' : '')
						    + ' onclick = "onImgClick( '+ i + ')\"'
						    + '></img>';
			/*const cardW = 100
			const cardH = 150
			const cardSpacing = 0
			const img = new Image()
			img.onload = () => ctx.drawImage(img, i * (cardW+cardSpacing), 0)
			img.src = myHand[i]*/
		}
	}

	const displayStateMessage = () => {
		html.innerHTML += 
		"<p>"
			+ ((myGameMasterID === myPlayerID) ? "Pick a card, dear Game Master" : "Waiting for the Game Master to pick a card")
		+"</p>"
	}

	const drawPlayerList = () => {
		/*ctx.font = '25pt Calibri';
		for (let i = 0; i < myPlayerList.length; ++i){
			const player = myPlayerList[i]
			ctx.fillStyle = player.color;
			ctx.fillText(player.name, 30, 30 + 40 * i)
			if (i == myGameMasterIndex) {
				ctx.beginPath();
				ctx.arc(15, -10 + 30 + 40 * i, 10, 0, 2 * Math.PI);
				ctx.fill();
			}
		}*/
	}

	const draw = () => {
		html.innerHTML = ''
		//ctx.clearRect(0, 0, 500, 500)
		//drawPlayerList()
		displayStateMessage()
		drawHand()
	}

	socket.on('HandChanged', data => {
		myHand = data.cardsImgData
		draw()
	})

	socket.on('PlayerListChanged', data => {
		myPlayerList = data.playerList
		draw()
	})

	socket.on('GameMasterChanged', data => {
		myGameMasterID = data.gameMasterID
		draw()
	})

	socket.on('ThisIsYourID', data => {
		myPlayerID = data.id
	})

</script>