<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>

<script src="/socket.io/socket.io.js"></script>
<!---<script src="https://cdn.jsdelivr.net/npm/p5@1.0.0/lib/p5.min.js"></script><-->

<script>
	const ctx = document.getElementById("ctx").getContext("2d")
	const canvas = document.querySelector('canvas')
	const socket = io()

	let img = new Image();
	img.addEventListener('load', 
		() => ctx.drawImage(img, 0, 0, 100, 100)
	, false);
	img.src = 'https://i.pinimg.com/originals/54/7a/9c/547a9cc6b93e10261f1dd8a8af474e03.jpg';

	let myHand = [];
	let myPlayerList = [];
	let myGameMasterIndex = 0;

	const onMouseClick = (canvas, event) => {
		// Get x and y
	    const rect = canvas.getBoundingClientRect()
	    const x = event.clientX - rect.left
	    const y = event.clientY - rect.top
	    //
	    socket.emit('changeGameMaster')
	}
	canvas.addEventListener('mousedown', e => onMouseClick(canvas, e))

	const drawHand = () => {
		for (let i = 0; i < myHand.length; ++i){
			ctx.beginPath();
			ctx.fillStyle = myHand[i];
			const cardW = 50
			const cardH = 150
			const margin = 20
			ctx.rect(15 + i*(cardW+margin), 500 - 15 - cardH, cardW, cardH)
			ctx.fill()
		}
	}

	const drawPlayerList = () => {
		ctx.font = '25pt Calibri';
		for (let i = 0; i < myPlayerList.length; ++i){
			const player = myPlayerList[i]
			ctx.fillStyle = player.color;
			ctx.fillText(player.name, 30, 30 + 40 * i)
			if (i == myGameMasterIndex) {
				ctx.beginPath();
				ctx.arc(15, -10 + 30 + 40 * i, 10, 0, 2 * Math.PI);
				ctx.fill();
			}
		}
	}

	const draw = () => {
		ctx.clearRect(0, 0, 500, 500)
		drawPlayerList()
		drawHand()
	}

	socket.on('HandChanged', data => {
		myHand = data.hand
		draw()
	})

	socket.on('PlayerListChanged', data => {
		myPlayerList = data.playerList
		draw()
	})

	socket.on('GameMasterChanged', data => {
		myGameMasterIndex = data.gameMasterIndex
		draw()
	})

</script>